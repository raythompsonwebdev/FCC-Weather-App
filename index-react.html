
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Weather App</title>
    <link rel="stylesheet" href="weather.css">
    <script src="https://unpkg.com/react@16.8.2/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16.8.2/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>

  <div id="root"></div>

  <script type="text/babel">

  //show image according to weather
    let Ftemp = null;
    
    const WeatherBoxes = props => {

        console.log(props)
        
        let Ftemp = (props.Ktemp)*(9/5) + 32;

        const tempVisibility = (e) => {
            
            var tempChange;

            e.preventDefault();

            if (!tempChange){
                
                console.log(Ktemp)
            }else { 
                console.log(Ftemp)
            }
            
        }
               
            return (
                <>
                    <h1 id="header_title">Weather App</h1>
                    <h2>{props.city}</h2>
                    <span className="weatherbox" id="image"><img src={props.weathericon} /></span>
                    <span className="weatherbox" id="speed"><p>{props.weather}</p></span>
                    <span className="weatherbox" id="description"><p>{props.weatherdesc}</p></span>
                    <span className="weatherbox" id="temperature"><p>{`Temperature: ${Math.floor(props.Ktemp)}`}</p></span>
                    <button onClick={tempVisibility} id="tempbtn">Convert &#8451; to &#8457;</button>
                </>
            ); 
    }
    
        
    class WeatherApp extends React.Component{

        constructor(props){
            super(props)
            this.state = {                
                city : " ",
                weather : " ",
                weatherdesc : " ",
                weathericon : " ",
                wind : " ",         
                Ktemp : " ",
                
            }
        }                  

        componentDidMount() {

            let currentComponent = this; // cached this so that it is available inside fetch

            if (navigator.geolocation) {

                navigator.geolocation.getCurrentPosition(function(position){

                    var lat = position.coords.latitude;
                    var lon = position.coords.longitude; 

                    // getWeather = async() => {
                    //     const url = await fetch(`https://fcc-weather-api.glitch.me/api/current?lat=${lat}&lon=${lon}`);

                    //     const response = await url.json();
                    //     this.setState({data : response.data})
                    //     console.log(this.state.data)
                    // }

                    var url = `https://fcc-weather-api.glitch.me/api/current?lat=${lat}&lon=${lon}`

                    //var url = `https://fcc-w-app.herokuapp.com/api/data/2.5/weather?lat=${lat}&lon=${lon}`

                    fetch(url)
                    .then((response) => {

                        return response.json()

                    })
                    .then( result => {

                        console.log(result)

                        currentComponent.setState({
                            city : result.name,
                            weather : result.weather[0].main,
                            weatherdesc : result.weather[0].description,
                            weathericon : result.weather[0].icon,
                            wind : result.wind.speed,         
                            Ktemp : result.main.temp,
                        });

                                          
                    })
                    .catch((error) => {
                        console.log(error);
                    });

                });
            }
            else {
                
                alert("Geolocation is not supported by this browser.");            
            }

        }

                       
        render(){

        const { data } = this.state;
       
            return (
                <div id="container">                     
                    <WeatherBoxes 
                        city = {this.state.city}
                        weather = {this.state.weather}
                        weatherdesc = {this.state.weatherdesc}
                        weathericon = {this.state.weathericon}
                        wind = {this.state.wind}         
                        Ktemp = {this.state.Ktemp}

                    />                     
                </div>

            )
        }
    }

    ReactDOM.render(
        <WeatherApp />,
        document.getElementById("root")
    );
</script>
   
    
</body>
</html>
